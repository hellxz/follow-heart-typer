## :egg:开发调试文档

本软件使用yarn作为node.js的包管理器，需提前装好node.js与npm，以下区分操作系统部分在前，通用部分在后

### 1、安装Yarn

-   Windows：使用exe安装自动添加path 或 使用通用方式

-   通用方式：npm全局安装yarn `npm install yarn -g`

### 2、配置Yarn

-   设置缓存目录：

    ```bash
    yarn config set cache-folder "/path/to/path"
    ```

    >   1.  Windows环境需删除`用户变量`的`PATH`的`C:\Users\用户名\AppData\Roaming\npm` 部分
    >
    >   2.  如果有yarn相关的变量一并删除
    >   3.  `用户变量`的`PATH`后追加`;C:\Users\用户名\AppData\Local\Yarn\Data\global\node_modules\.bin  `

-   设置淘宝镜像：

    ```bash
    yarn config set registry "https://registry.npm.taobao.org"
    ```

### 3、使用Electron国内镜像加速下载

>   在安装过程中，electron 模块会通过 electron-download 为您的平台下载 Electron 的来自Github的预编译二进制文件，需要单独设置下载源以加速

-   Windows：系统变量或用户变量中添加 `ELECTRON_MIRROR` 值为`https://npm.taobao.org/mirrors/electron/`

-   Linux/MacOS：将`export ELECTRON_MIRROR="https://npm.taobao.org/mirrors/electron/"`写在配置环境变量的文件中，这些位置有：

    -   `/etc/profile` （系统全局）
    -   `/etc/profile.d/` 下的shell文件（自定义系统全局）
    -   `~/.bashrc` （当前用户）

    修改之后 `source 修改的文件` 即可。

### 4、启动本项目

项目克隆到本地

```bash
git clone https://gitee.com/hellxz/follow-heart-typer.git
cd follow-heart-typer
```

安装node依赖

```bash
yarn install
```

启动项目

```bash
yarn start
```

### 5、开发调试技巧、简单说明

-   项目运行后，会开启调式窗口
-   应用运行期间，可以修改代码，通过在调试窗口执行Ctrl+R以刷新页面（仅支持渲染页面）
-   electron会创建一个主窗口，它的权力是最大的，可以完成很多操作，如创建窗口等
-   其他渲染页面与主窗口使用IPC通信（主窗口执有`ipcMain`，渲染页面执有`ipcRenderer`，分别使用这两个对象进行监听事件）
-   修改窗口级代码，需要重运行项目才生效
-   暂时未提供打包的配置（无CI无配置平台）
-   临时想到这，etc

### 6、构建打包

随心跟打器使用 electron-forge 进行构建与打包，可以分开解释

#### 构建二进制

```bash
yarn package
cd out
tar zcf follow-heart-typer-<版本号>_amd64.tar.gz follow-heart-typer-linux-x64
```

>   自动根据平台进行打包，生成未压缩的可执行文件及资源到out目录下，其他平台用户自行尝试

#### 打成 deb 包

```bash
yarn make
```

>   环境需要在 Debian/Ubuntu及子发行版下构建